{"version":3,"sources":["../src/obaa.js","../src/path.js","../src/react.js","../src/omis.js"],"names":["obaa","target","arr","callback","eventPropArr","isArray","length","__o_","__r_","__p_","mock","prop","hasOwnProperty","isInArray","push","watch","isString","__c_","propChanged","all","root","methods","forEach","item","old","Array","prototype","slice","call","this","result","apply","arguments","RegExp","test","triggerStr","cprop","isFunction","onPropertyChanged","substring","toUpperCase","path","undefined","currentValue","value","oldValue","nan","rootName","getRootName","i","len","handler","indexOf","obj","Object","toString","isNaN","split","OBJECTTYPE","ARRAYTYPE","tempPath","keys","getUpdatePath","data","key","type","dataToPath","_arrayToPath","_objToPath","index","needUpdate","diffResult","updatePath","keyA","includePath","keyB","pathA","pathB","next","fixPath","mpPath","replace","Number","instance","Constructor","TypeError","isSelf","currentComponent","$r","options","val","omis","components","patch","component","X","state","__$id_","updateSelfComponents","__$updateSelfPath_","use","getPath","updateSelfPath","useSelf","_class2","props","_classCallCheck","_this","_possibleConstructorReturn","_React$Component","_inherits","shouldComponentUpdate","render","React","Component","join","add","set","size","version","global","Math","getGlobal","omis$1","module","exports","self","Omis"],"mappings":"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","file":"omis.js","sourcesContent":["\nexport function obaa(target, arr, callback) {\n\n  var eventPropArr = []\n  if (isArray(target)) {\n    if (target.length === 0) {\n      target.__o_ = {\n        __r_: target,\n        __p_: '#'\n      }\n    }\n    mock(target, target)\n  }\n  for (var prop in target) {\n    if (target.hasOwnProperty(prop)) {\n      if (callback) {\n        if (isArray(arr) && isInArray(arr, prop)) {\n          eventPropArr.push(prop)\n          watch(target, prop, null, target)\n        } else if (isString(arr) && prop === arr) {\n          eventPropArr.push(prop)\n          watch(target, prop, null, target)\n        }\n      } else {\n        eventPropArr.push(prop)\n        watch(target, prop, null, target)\n      }\n    }\n  }\n  if (!target.__c_) {\n    target.__c_ = []\n  }\n  var propChanged = callback ? callback : arr\n  target.__c_.push({\n    all: !callback,\n    propChanged: propChanged,\n    eventPropArr: eventPropArr\n  })\n}\n\nvar triggerStr = [\n  'concat',\n  'copyWithin',\n  'fill',\n  'pop',\n  'push',\n  'reverse',\n  'shift',\n  'sort',\n  'splice',\n  'unshift',\n  'size'\n].join(',')\n\nvar methods = [\n  'concat',\n  'copyWithin',\n  'entries',\n  'every',\n  'fill',\n  'filter',\n  'find',\n  'findIndex',\n  'forEach',\n  'includes',\n  'indexOf',\n  'join',\n  'keys',\n  'lastIndexOf',\n  'map',\n  'pop',\n  'push',\n  'reduce',\n  'reduceRight',\n  'reverse',\n  'shift',\n  'slice',\n  'some',\n  'sort',\n  'splice',\n  'toLocaleString',\n  'toString',\n  'unshift',\n  'values',\n  'size'\n]\n\nfunction mock(target, root) {\n  methods.forEach(function (item) {\n    target[item] = function () {\n      var old = Array.prototype.slice.call(this, 0)\n      var result = Array.prototype[item].apply(\n        this,\n        Array.prototype.slice.call(arguments)\n      )\n      if (new RegExp('\\\\b' + item + '\\\\b').test(triggerStr)) {\n        for (var cprop in this) {\n          if (\n            this.hasOwnProperty(cprop) &&\n            !isFunction(this[cprop])\n          ) {\n            watch(this, cprop, this.__o_.__p_, root)\n          }\n        }\n        //todo\n        onPropertyChanged(\n          'Array-' + item,\n          this,\n          old,\n          this,\n          this.__o_.__p_,\n          root\n        )\n      }\n      return result\n    }\n    target[\n      'pure' + item.substring(0, 1).toUpperCase() + item.substring(1)\n    ] = function () {\n      return Array.prototype[item].apply(\n        this,\n        Array.prototype.slice.call(arguments)\n      )\n    }\n  })\n}\n\nfunction watch(target, prop, path, root) {\n  if (prop === '__o_') return\n  if (isFunction(target[prop])) return\n  if (!target.__o_) target.__o_ = {\n    __r_: root\n  }\n  if (path !== undefined && path !== null) {\n    target.__o_.__p_ = path\n  } else {\n    target.__o_.__p_ = '#'\n  }\n\n  var currentValue = (target.__o_[prop] = target[prop])\n  Object.defineProperty(target, prop, {\n    get: function () {\n      return this.__o_[prop]\n    },\n    set: function (value) {\n      var old = this.__o_[prop]\n      this.__o_[prop] = value\n      onPropertyChanged(\n        prop,\n        value,\n        old,\n        this,\n        target.__o_.__p_,\n        root\n      )\n    },\n    configurable: true,\n    enumerable: true\n  })\n  if (typeof currentValue === 'object') {\n    if (isArray(currentValue)) {\n      mock(currentValue, root)\n      if (currentValue.length === 0) {\n        if (!currentValue.__o_) currentValue.__o_ = {}\n        if (path !== undefined && path !== null) {\n          currentValue.__o_.__p_ = path + '-' + prop\n        } else {\n          currentValue.__o_.__p_ = '#-' + prop\n        }\n      }\n    }\n    for (var cprop in currentValue) {\n      if (currentValue.hasOwnProperty(cprop)) {\n        watch(\n          currentValue,\n          cprop,\n          target.__o_.__p_ + '-' + prop,\n          root\n        )\n      }\n    }\n  }\n}\n\n\nfunction onPropertyChanged(prop, value, oldValue, target, path, root) {\n  if (value !== oldValue && (!(nan(value) && nan(oldValue))) && root.__c_) {\n    var rootName = getRootName(prop, path)\n    for (\n      var i = 0, len = root.__c_.length; i < len; i++\n    ) {\n      var handler = root.__c_[i]\n      if (\n        handler.all ||\n        isInArray(handler.eventPropArr, rootName) ||\n        rootName.indexOf('Array-') === 0\n      ) {\n        handler.propChanged.call(target, prop, value, oldValue, path)\n      }\n    }\n  }\n\n  if (prop.indexOf('Array-') !== 0 && typeof value === 'object') {\n    watch(target, prop, target.__o_.__p_, root)\n  }\n}\n\nfunction isFunction(obj) {\n  return Object.prototype.toString.call(obj) === '[object Function]'\n}\n\nfunction nan(value) {\n  return typeof value === \"number\" && isNaN(value)\n}\n\nfunction isArray(obj) {\n  return Object.prototype.toString.call(obj) === '[object Array]'\n}\n\nfunction isString(obj) {\n  return typeof obj === 'string'\n}\n\nfunction isInArray(arr, item) {\n  for (var i = arr.length; --i > -1;) {\n    if (item === arr[i]) return true\n  }\n  return false\n}\n\n\nfunction getRootName(prop, path) {\n  if (path === '#') {\n    return prop\n  }\n  return path.split('-')[1]\n}\n\nobaa.add = function (obj, prop) {\n  watch(obj, prop, obj.__o_.__p_, obj.__o_.__r_)\n}\n\nobaa.set = function (obj, prop, value) {\n  watch(obj, prop, obj.__o_.__p_, obj.__o_.__r_)\n  obj[prop] = value\n}\n\n//@ts-ignore\n/* eslint-disable */\nArray.prototype.size = function (length) {\n  this.length = length\n}","\nconst OBJECTTYPE = '[object Object]'\nconst ARRAYTYPE = '[object Array]'\n\nexport function getUsing(data, paths) {\n  const obj = []\n  paths.forEach((path, index) => {\n    const isPath = typeof path === 'string'\n    if (isPath) {\n      obj[index] = getTargetByPath(data, path)\n    } else {\n      const key = Object.keys(path)[0]\n      const value = path[key]\n      if (typeof value === 'string') {\n        obj[index] = getTargetByPath(data, value)\n      } else {\n        const tempPath = value[0]\n        if (typeof tempPath === 'string') {\n          const tempVal = getTargetByPath(data, tempPath)\n          obj[index] = value[1] ? value[1](tempVal) : tempVal\n        } else {\n          const args = []\n          tempPath.forEach(path =>{\n            args.push(getTargetByPath(data, path))\n          })\n          obj[index] = value[1].apply(null, args)\n        }\n      }\n      obj[key] = obj[index]\n    }\n  })\n  return obj\n}\n\nexport function getTargetByPath(origin, path) {\n  const arr = path.replace(/]/g, '').replace(/\\[/g, '.').split('.')\n  let current = origin\n  for (let i = 0, len = arr.length; i < len; i++) {\n    current = current[arr[i]]\n  }\n  return current\n}\n\n\nexport function getPath(obj) {\n  if (Object.prototype.toString.call(obj) === '[object Array]') {\n    const result = {}\n    obj.forEach(item => {\n      if (typeof item === 'string') {\n        result[item] = true\n      } else {\n        const tempPath = item[Object.keys(item)[0]]\n        if (typeof tempPath === 'string') {\n          result[tempPath] = true\n        } else {\n          if(typeof tempPath[0] === 'string'){\n            result[tempPath[0]] = true\n          }else{\n            tempPath[0].forEach(path => result[path] = true)\n          }\n        }\n      }\n    })\n    return result\n  } else {\n    return getUpdatePath(obj)\n  }\n}\n\nexport function getUpdatePath(data) {\n  const result = {}\n  dataToPath(data, result)\n  return result\n}\n\nfunction dataToPath(data, result) {\n  Object.keys(data).forEach(key => {\n    result[key] = true\n    const type = Object.prototype.toString.call(data[key])\n    if (type === OBJECTTYPE) {\n      _objToPath(data[key], key, result)\n    } else if (type === ARRAYTYPE) {\n      _arrayToPath(data[key], key, result)\n    }\n  })\n}\n\nfunction _objToPath(data, path, result) {\n  Object.keys(data).forEach(key => {\n    result[path + '.' + key] = true\n    delete result[path]\n    const type = Object.prototype.toString.call(data[key])\n    if (type === OBJECTTYPE) {\n      _objToPath(data[key], path + '.' + key, result)\n    } else if (type === ARRAYTYPE) {\n      _arrayToPath(data[key], path + '.' + key, result)\n    }\n  })\n}\n\nfunction _arrayToPath(data, path, result) {\n  data.forEach((item, index) => {\n    result[path + '[' + index + ']'] = true\n    delete result[path]\n    const type = Object.prototype.toString.call(item)\n    if (type === OBJECTTYPE) {\n      _objToPath(item, path + '[' + index + ']', result)\n    } else if (type === ARRAYTYPE) {\n      _arrayToPath(item, path + '[' + index + ']', result)\n    }\n  })\n}\n\n\nexport function needUpdate(diffResult, updatePath) {\n  for (let keyA in diffResult) {\n    if (updatePath[keyA]) {\n      return true\n    }\n    for (let keyB in updatePath) {\n      if (includePath(keyA, keyB)) {\n        return true\n      }\n    }\n  }\n  return false\n}\n\nfunction includePath(pathA, pathB) {\n  if (pathA.indexOf(pathB) === 0) {\n    const next = pathA.substr(pathB.length, 1)\n    if (next === '[' || next === '.') {\n      return true\n    }\n  }\n  return false\n}\n\nexport function fixPath(path) {\n  let mpPath = ''\n  const arr = path.replace('#-', '').split('-')\n  arr.forEach((item, index) => {\n    if (index) {\n      if (isNaN(Number(item))) {\n        mpPath += '.' + item\n      } else {\n        mpPath += '[' + item + ']'\n      }\n    } else {\n      mpPath += item\n    }\n  })\n  return mpPath\n}\n","import React from 'react'\nimport {obaa} from './obaa'\nimport {\n  getPath,\n  needUpdate,\n  fixPath\n} from './path'\n\nconst components = []\nconst updateSelfComponents = []\n\nlet isSelf = false\nlet currentComponent = null\n\nexport function $r(options) {\n  if (options.store) {\n    omis.store = options.store\n    obaa(omis.store.data, (prop, val, old, path) => {\n      const patch = {}\n\n      patch[fixPath(path + '-' + prop)] = true\n      components.forEach(component => {\n        if (component.__$updatePath_ && needUpdate(patch, component.__$updatePath_)) {\n          component.setState({ __$id_: component.state.__$id_++ });\n\n          isSelf = false\n        }\n      })\n\n      updateSelfComponents.forEach(component => {\n        if (component.__$updateSelfPath_ && needUpdate(patch, component.__$updateSelfPath_)) {\n          component.setState({ __$id_: component.state.__$id_++ });\n          isSelf = true\n          currentComponent = component\n        }\n      })\n    })\n  }\n\n  const updatePath = options.use && getPath(options.use)\n  const updateSelfPath = options.useSelf && getPath(options.useSelf)\n\n  return class extends React.Component {\n\n    state = {\n      __$id_: 0\n    }\n\n    constructor(props) {\n      super(props)\n      if (updatePath) {\n        components.push(this)\n        this.__$updatePath_ = updatePath\n      }\n      if (updateSelfPath) {\n        updateSelfComponents.push(this)\n        this.__$updateSelfPath_ = updateSelfPath\n      }\n    }\n\n    shouldComponentUpdate() {\n      if (currentComponent === this) return true\n      return !isSelf\n    }\n\n    render() {\n      return options.render.apply(this, arguments)\n    }\n  }\n}","\nimport {$r} from './react'\n\nconst root = getGlobal()\n\nconst omis = {\n  $r\n}\n\nroot.Omis = omis\nroot.omis = omis\nroot.Omis.version = '2.0.0'\n\nexport default omis\n\nexport {\n  $r\n}\n\n\nfunction getGlobal() {\n  if (\n    typeof global !== 'object' ||\n    !global ||\n    global.Math !== Math ||\n    global.Array !== Array\n  ) {\n    return (\n      self ||\n      window ||\n      global ||\n      (function() {\n        return this\n      })()\n    )\n  }\n  return global\n}"]}