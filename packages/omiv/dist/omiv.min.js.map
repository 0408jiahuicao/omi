{"version":3,"sources":["../src/obaa.js","../src/path.js","../src/vue.js","../src/omiv.js"],"names":["obaa","target","arr","callback","eventPropArr","isArray","length","__o_","__r_","__p_","mock","prop","hasOwnProperty","isInArray","push","watch","isString","__c_","all","propChanged","root","methods","forEach","item","old","Array","prototype","slice","call","this","result","apply","arguments","RegExp","test","triggerStr","cprop","isFunction","onPropertyChanged","substring","toUpperCase","path","currentValue","Object","defineProperty","get","set","value","configurable","enumerable","oldValue","nan","rootName","getRootName","i","len","handler","indexOf","obj","toString","isNaN","split","getPath","out","name","tempPath","keys","needUpdate","diffResult","updatePath","keyA","keyB","includePath","pathA","pathB","next","substr","fixPath","mpPath","replace","index","$","options","beforeCreate","destroyed","use","useSelf","computed","store","reset","$store","isMultiStore","storeName","components","__$updatePath_","updateSelfPath","updateSelfComponents","__$updateSelfPath_","key","removeItem","state","k","data","recUpdate","$forceUpdate","$children","child","observe","window","val","patch","component","p","sp","splice","render","app","renderTo","initStore","Vue","assign","h","$mount","process","env","NODE_ENV","console","error","s","install","_Vue","applyMixin","omivInit","_this","$options","parent","replaceState","startsWith","omivDestroyed","mixin","$state","add","size","module","exports","Omiv","self"],"mappings":"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","file":"omiv.min.js","sourcesContent":["export function obaa(target, arr, callback) {\n  let eventPropArr = []\n  if (isArray(target)) {\n    if (target.length === 0) {\n      target.__o_ = {\n        __r_: target,\n        __p_: '#'\n      }\n    }\n    mock(target, target)\n  }\n  for (let prop in target) {\n    if (target.hasOwnProperty(prop)) {\n      if (callback) {\n        if (isArray(arr) && isInArray(arr, prop)) {\n          eventPropArr.push(prop)\n          watch(target, prop, null, target)\n        } else if (isString(arr) && prop === arr) {\n          eventPropArr.push(prop)\n          watch(target, prop, null, target)\n        }\n      } else {\n        eventPropArr.push(prop)\n        watch(target, prop, null, target)\n      }\n    }\n  }\n  if (!target.__c_) {\n    target.__c_ = []\n  }\n  let propChanged = callback ? callback : arr\n  target.__c_.push({\n    all: !callback,\n    propChanged,\n    eventPropArr\n  })\n}\n\nlet triggerStr = [\n  'concat',\n  'copyWithin',\n  'fill',\n  'pop',\n  'push',\n  'reverse',\n  'shift',\n  'sort',\n  'splice',\n  'unshift',\n  'size'\n].join(',')\n\nlet methods = [\n  'concat',\n  'copyWithin',\n  'entries',\n  'every',\n  'fill',\n  'filter',\n  'find',\n  'findIndex',\n  'forEach',\n  'includes',\n  'indexOf',\n  'join',\n  'keys',\n  'lastIndexOf',\n  'map',\n  'pop',\n  'push',\n  'reduce',\n  'reduceRight',\n  'reverse',\n  'shift',\n  'slice',\n  'some',\n  'sort',\n  'splice',\n  'toLocaleString',\n  'toString',\n  'unshift',\n  'values',\n  'size'\n]\n\nfunction mock(target, root) {\n  methods.forEach(item => {\n    target[item] = function() {\n      let old = Array.prototype.slice.call(this, 0)\n      let result = Array.prototype[item].apply(\n        this,\n        Array.prototype.slice.call(arguments)\n      )\n      if (new RegExp('\\\\b' + item + '\\\\b').test(triggerStr)) {\n        for (let cprop in this) {\n          if (this.hasOwnProperty(cprop) && !isFunction(this[cprop])) {\n            watch(this, cprop, this.__o_.__p_, root)\n          }\n        }\n        //todo\n        onPropertyChanged(\n          'Array-' + item,\n          this,\n          old,\n          this,\n          this.__o_.__p_,\n          root\n        )\n      }\n      return result\n    }\n    target[\n      'pure' + item.substring(0, 1).toUpperCase() + item.substring(1)\n    ] = function() {\n      return Array.prototype[item].apply(\n        this,\n        Array.prototype.slice.call(arguments)\n      )\n    }\n  })\n}\n\nfunction watch(target, prop, path, root) {\n  if (prop === '__o_') return\n  if (isFunction(target[prop])) return\n  if (!target.__o_)\n    target.__o_ = {\n      __r_: root\n    }\n  if (path !== undefined && path !== null) {\n    target.__o_.__p_ = path\n  } else {\n    target.__o_.__p_ = '#'\n  }\n\n  let currentValue = (target.__o_[prop] = target[prop])\n  Object.defineProperty(target, prop, {\n    get() {\n      return this.__o_[prop]\n    },\n    set(value) {\n      let old = this.__o_[prop]\n      this.__o_[prop] = value\n      onPropertyChanged(prop, value, old, this, target.__o_.__p_, root)\n    },\n    configurable: true,\n    enumerable: true\n  })\n  if (typeof currentValue === 'object') {\n    if (isArray(currentValue)) {\n      mock(currentValue, root)\n      if (currentValue.length === 0) {\n        if (!currentValue.__o_) currentValue.__o_ = {}\n        if (path !== undefined && path !== null) {\n          currentValue.__o_.__p_ = path + '-' + prop\n        } else {\n          currentValue.__o_.__p_ = '#-' + prop\n        }\n      }\n    }\n    for (let cprop in currentValue) {\n      if (currentValue.hasOwnProperty(cprop)) {\n        watch(currentValue, cprop, target.__o_.__p_ + '-' + prop, root)\n      }\n    }\n  }\n}\n\nfunction onPropertyChanged(prop, value, oldValue, target, path, root) {\n  if (value !== oldValue && !(nan(value) && nan(oldValue)) && root.__c_) {\n    let rootName = getRootName(prop, path)\n    for (let i = 0, len = root.__c_.length; i < len; i++) {\n      let handler = root.__c_[i]\n      if (\n        handler.all ||\n        isInArray(handler.eventPropArr, rootName) ||\n        rootName.indexOf('Array-') === 0\n      ) {\n        handler.propChanged.call(target, prop, value, oldValue, path)\n      }\n    }\n  }\n\n  if (prop.indexOf('Array-') !== 0 && typeof value === 'object') {\n    watch(target, prop, target.__o_.__p_, root)\n  }\n}\n\nfunction isFunction(obj) {\n  return Object.prototype.toString.call(obj) === '[object Function]'\n}\n\nfunction nan(value) {\n  return typeof value === 'number' && isNaN(value)\n}\n\nfunction isArray(obj) {\n  return Object.prototype.toString.call(obj) === '[object Array]'\n}\n\nfunction isString(obj) {\n  return typeof obj === 'string'\n}\n\nfunction isInArray(arr, item) {\n  for (let i = arr.length; --i > -1; ) {\n    if (item === arr[i]) return true\n  }\n  return false\n}\n\nfunction getRootName(prop, path) {\n  if (path === '#') {\n    return prop\n  }\n  return path.split('-')[1]\n}\n\nobaa.add = function(obj, prop) {\n  watch(obj, prop, obj.__o_.__p_, obj.__o_.__r_)\n}\n\nobaa.set = function(obj, prop, value) {\n  watch(obj, prop, obj.__o_.__p_, obj.__o_.__r_)\n  obj[prop] = value\n}\n\n//@ts-ignore\n/* eslint-disable */\nArray.prototype.size = function (length) {\n  this.length = length\n}\n","export function getUsing(data, paths) {\n  const obj = []\n  paths.forEach((path, index) => {\n    const isPath = typeof path === 'string'\n    if (isPath) {\n      obj[index] = getTargetByPath(data, path)\n    } else {\n      const key = Object.keys(path)[0]\n      const value = path[key]\n      if (typeof value === 'string') {\n        obj[index] = getTargetByPath(data, value)\n      } else {\n        const tempPath = value[0]\n        if (typeof tempPath === 'string') {\n          const tempVal = getTargetByPath(data, tempPath)\n          obj[index] = value[1] ? value[1](tempVal) : tempVal\n        } else {\n          const args = []\n          tempPath.forEach(path => {\n            args.push(getTargetByPath(data, path))\n          })\n          obj[index] = value[1].apply(null, args)\n        }\n      }\n      obj[key] = obj[index]\n    }\n  })\n  return obj\n}\n\nexport function getTargetByPath(origin, path) {\n  const arr = path\n    .replace(/]/g, '')\n    .replace(/\\[/g, '.')\n    .split('.')\n  let current = origin\n  for (let i = 0, len = arr.length; i < len; i++) {\n    current = current[arr[i]]\n  }\n  return current\n}\n\nexport function getPath(obj, out, name) {\n  const result = {}\n  obj.forEach(item => {\n    if (typeof item === 'string') {\n      result[item] = true\n    } else {\n      const tempPath = item[Object.keys(item)[0]]\n      if (typeof tempPath === 'string') {\n        result[tempPath] = true\n      } else if (typeof tempPath[0] === 'string') {\n        result[tempPath[0]] = true\n      } else {\n        tempPath[0].forEach(path => (result[path] = true))\n      }\n    }\n  })\n  out && (out[name] = result)\n  return result\n}\n\nexport function needUpdate(diffResult, updatePath) {\n  for (let keyA in diffResult) {\n    if (updatePath[keyA]) {\n      return true\n    }\n    for (let keyB in updatePath) {\n      if (includePath(keyA, keyB)) {\n        return true\n      }\n    }\n  }\n  return false\n}\n\nfunction includePath(pathA, pathB) {\n  if (pathA.indexOf(pathB) === 0) {\n    const next = pathA.substr(pathB.length, 1)\n    if (next === '[' || next === '.') {\n      return true\n    }\n  }\n  return false\n}\n\nexport function fixPath(path) {\n  let mpPath = ''\n  const arr = path.replace('#-', '').split('-')\n  arr.forEach((item, index) => {\n    if (index) {\n      if (isNaN(Number(item))) {\n        mpPath += '.' + item\n      } else {\n        mpPath += '[' + item + ']'\n      }\n    } else {\n      mpPath += item\n    }\n  })\n  return mpPath\n}\n","import { obaa } from './obaa'\nimport { getPath, needUpdate, fixPath } from './path'\n\nlet Vue\nlet store\nlet isMultiStore = false\n\nexport function $(options) {\n  const beforeCreate = options.beforeCreate\n  const destroyed = options.destroyed\n  const use = options.use\n  const useSelf = options.useSelf\n  options.computed = options.computed || {}\n\n  if (options.store) {\n    reset(options.store)\n  }\n\n  options.beforeCreate = function () {\n    this.$store = store\n    if (isMultiStore) {\n      if (use) {\n        let updatePath = {}\n        for (let storeName in use) {\n          getPath(use[storeName], updatePath, storeName)\n          store[storeName].components.push(this)\n        }\n        this.__$updatePath_ = updatePath\n      }\n\n      if (useSelf) {\n        let updateSelfPath = {}\n        for (let storeName in useSelf) {\n          getPath(useSelf[storeName], updateSelfPath, storeName)\n          store[storeName].updateSelfComponents.push(this)\n        }\n        this.__$updateSelfPath_ = updateSelfPath\n      }\n    } else {\n      if (use) {\n        this.__$updatePath_ = getPath(use)\n        store.components.push(this)\n      }\n      if (useSelf) {\n        this.__$updateSelfPath_ = getPath(useSelf)\n        store.updateSelfComponents.push(this)\n      }\n    }\n    beforeCreate && beforeCreate.apply(this, arguments)\n  }\n\n  options.destroyed = function () {\n    if (isMultiStore) {\n      for (let key in store) {\n        if (key !== 'replaceState') {\n          removeItem(this, store[key].components)\n          removeItem(this, store[key].updateSelfComponents)\n        }\n      }\n    } else {\n      removeItem(this, store.updateSelfComponents)\n      removeItem(this, store.components)\n    }\n\n    destroyed && destroyed.apply(this, arguments)\n  }\n\n  options.computed.state = function () {\n    if (isMultiStore) {\n      let state = {}\n      Object.keys(store).forEach(k => {\n        state[k] = store[k].data\n      })\n      return state\n    }\n    return store.data\n  }\n\n  options.computed.store = function () {\n    return store\n  }\n\n  return options\n}\n\nfunction recUpdate(root) {\n  root.$forceUpdate()\n  root.$children.forEach(child => {\n    recUpdate(child)\n  })\n}\n\nfunction observe(store, storeName) {\n  store.components = []\n  store.updateSelfComponents = []\n\n  // 非 window 环境下不需要观察数据\n  if (typeof window === 'undefined') return\n\n  obaa(store.data, (prop, val, old, path) => {\n    const patch = {}\n\n    patch[fixPath(path + '-' + prop)] = true\n    store.components.forEach(component => {\n      const p = component.__$updatePath_\n      if (storeName) {\n        if (p && p[storeName] && needUpdate(patch, p[storeName])) {\n          recUpdate(component)\n        }\n      } else if (p && needUpdate(patch, p)) {\n        recUpdate(component)\n      }\n    })\n\n    store.updateSelfComponents.forEach(component => {\n      const sp = component.__$updateSelfPath_\n      if (storeName) {\n        if (sp && sp[storeName] && needUpdate(patch, sp[storeName])) {\n          component.$forceUpdate()\n        }\n      } else if (sp && needUpdate(patch, sp)) {\n        component.$forceUpdate()\n      }\n    })\n  })\n}\n\nfunction removeItem(item, arr) {\n  for (let i = 0, len = arr.length; i < len; i++) {\n    if (arr[i] === item) {\n      arr.splice(i, 1)\n      break\n    }\n  }\n}\n\nexport function render(app, renderTo, initStore, options) {\n  if (!Vue) {\n    if (process.env.NODE_ENV !== 'production') {\n      // eslint-disable-next-line\n      console.error(\n        '[Omiv] has not been installed yet. Vue.use(Omiv) should be called first.'\n      )\n    }\n    return\n  }\n  // fix: 如果是在子节点通过 $ 注入的 store， 在 根实例中拿不到 $store\n  initStore = initStore || store\n  reset(initStore)\n\n  return new Vue(\n    Object.assign(\n      {\n        render: h => h(app)\n      },\n      options,\n      initStore ? { store: initStore } : {}\n    )\n  ).$mount(renderTo)\n}\n\nexport function reset(s) {\n  if (s) {\n    store = s\n    if (store.data) {\n      isMultiStore = false\n      observe(store)\n    } else {\n      isMultiStore = true\n      for (let key in store) {\n        if (store[key].data) {\n          observe(store[key], key)\n        }\n      }\n    }\n  } else {\n    // 为了测试用例正确执行的特殊处理，测试用例中多次执行 Omiv.render\n    // 导致 store 变量存储的是上一个用例的 store，使得再次调用 Omiv.render(Component, '#app')\n    // 不传 store 的时候，会被污染，导致用例执行异常。正常项目中应该不会走到这里的逻辑。\n    store = undefined\n  }\n}\n\n// Vue.use 会判断是否重复安装\nexport function install(_Vue) {\n  Vue = _Vue\n  applyMixin(Vue)\n}\n\nfunction applyMixin(Vue) {\n  const omivComputed = {\n    $state() {\n      if (isMultiStore) {\n        let state = {}\n        Object.keys(this.$store).forEach(k => {\n          state[k] = store[k].data\n        })\n        return state\n      }\n      return this.$store.data\n    }\n  }\n\n  function omivInit() {\n    const options = this.$options\n    const use = options.use\n    const useSelf = options.useSelf\n\n    // TODO: 可能要处理一下在不同地方注入多个 store ？\n\n    if (options.store) {\n      this.$store =\n        typeof options.store === 'function' ? options.store() : options.store\n    } else if (options.parent && options.parent.$store) {\n      this.$store = options.parent.$store\n    }\n\n    // 在 ssr 中用于替换 store\n    if (this.$store && !this.$store.replaceState) {\n      this.$store.replaceState = (store = {}) => {\n        Object.keys(store).forEach(key => {\n          // 过滤观察字段\n          if (!key.startsWith('_')) {\n            this.$store.data[key] = store[key]\n          }\n        })\n      }\n    }\n\n    // 修复不是在 main.js 中注入 store 的问题\n    if (this.$store && !store) {\n      reset(this.$store)\n    }\n\n    if (isMultiStore) {\n      if (use) {\n        let updatePath = {}\n        for (let storeName in use) {\n          getPath(use[storeName], updatePath, storeName)\n          this.$store[storeName].components.push(this)\n        }\n        this.__$updatePath_ = updatePath\n      }\n\n      if (useSelf) {\n        let updateSelfPath = {}\n        for (let storeName in useSelf) {\n          getPath(useSelf[storeName], updateSelfPath, storeName)\n          this.$store[storeName].updateSelfComponents.push(this)\n        }\n        this.__$updateSelfPath_ = updateSelfPath\n      }\n    } else {\n      if (use) {\n        // { count: true }\n        this.__$updatePath_ = getPath(use)\n        // 依赖 store 的组件，压入了一个 vm 实例\n        this.$store.components.push(this)\n      }\n      if (useSelf) {\n        this.__$updateSelfPath_ = getPath(useSelf)\n        this.$store.updateSelfComponents.push(this)\n      }\n    }\n  }\n\n  function omivDestroyed() {\n    if (isMultiStore) {\n      for (let key in this.$store) {\n        if (key !== 'replaceState') {\n          removeItem(this, this.$store[key].components)\n          removeItem(this, this.$store[key].updateSelfComponents)\n        }\n      }\n    } else {\n      removeItem(this, this.$store.updateSelfComponents)\n      removeItem(this, this.$store.components)\n    }\n  }\n\n  Vue.mixin({\n    beforeCreate: omivInit,\n    computed: omivComputed,\n    destroyed: omivDestroyed\n  })\n}\n","import { $, render, reset, install } from './vue'\n\nexport default { $, render, reset, install }\n\nexport { $, render, reset, install }\n"]}